<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flappy Matt</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background-color: #70c5ce;
            font-family: 'Arial', sans-serif;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }
        h1.game-title {
            color: white;
            font-size: 48px;
            text-shadow: 4px 4px 0px #333;
            margin-bottom: 10px;
            letter-spacing: 2px;
        }
        canvas {
            border: 4px solid #333;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            background-color: #70c5ce;
        }
        #instructions {
            margin-top: 15px;
            color: white;
            font-weight: bold;
            text-shadow: 1px 1px 2px #333;
            text-align: center;
        }
        #ui {
            position: absolute;
            text-align: center;
            user-select: none;
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 15px;
            border: 3px solid #333;
            z-index: 10;
            min-width: 220px;
            top: 55%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        .btn-group { display: flex; flex-direction: column; gap: 10px; }
        .menu-btn {
            padding: 12px;
            font-size: 18px;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: transform 0.1s;
        }
        .menu-btn:active { transform: scale(0.95); }
        .easy { background: #4caf50; }
        .medium { background: #ff9800; }
        .hard { background: #f44336; }
        .try-again { background: #2196F3; }
        #gameOverUI { display: none; }
    </style>
</head>
<body>

    <h1 class="game-title">Flappy Matt</h1>
    
    <div id="ui">
        <div id="startMenu">
            <h2>Select Difficulty</h2>
            <div class="btn-group">
                <button class="menu-btn easy" onclick="startGame('easy')">EASY</button>
                <button class="menu-btn medium" onclick="startGame('medium')">MEDIUM</button>
                <button class="menu-btn hard" onclick="startGame('hard')">DIFFICULT</button>
            </div>
        </div>

        <div id="gameOverUI">
            <h1>Nice Try!</h1>
            <p id="finalScoreDisplay" style="font-weight:bold; font-size: 20px;"></p>
            <div class="btn-group">
                <button class="menu-btn try-again" onclick="restartSameDifficulty()">TRY AGAIN</button>
                <button class="menu-btn medium" onclick="location.reload()">MAIN MENU</button>
            </div>
        </div>
    </div>

    <canvas id="gameCanvas"></canvas>

    <div id="instructions">
        tap your phone screen or press your space bar to "flap"
    </div>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const startMenu = document.getElementById('startMenu');
    const gameOverUI = document.getElementById('gameOverUI');
    const uiContainer = document.getElementById('ui');
    const finalScoreDisplay = document.getElementById('finalScoreDisplay');

    canvas.width = 400;
    canvas.height = 600;

    const GRAVITY = 0.20; 
    const JUMP = -5.0;    
    const HORIZONTAL_SPACING = 250; 

    let pipeSpeed = 1.0;
    let currentGap = 250; 
    let currentDifficulty = 'easy';
    
    let score = 0;
    let lives = 5;
    let bird, pipes, distanceTraveled, isPaused, isCountingDown, countdownValue, gameStarted = false;

    function startGame(difficulty) {
        currentDifficulty = difficulty;
        // Easy speed reduced by 40% (0.9 * 0.6 = 0.54)
        if (difficulty === 'easy') { pipeSpeed = 0.54; currentGap = 250; }
        else if (difficulty === 'medium') { pipeSpeed = 1.5; currentGap = 250; }
        else if (difficulty === 'hard') { pipeSpeed = 2.25; currentGap = 187.5; }

        uiContainer.style.display = 'none';
        gameStarted = true;
        score = 0;
        lives = 5;
        initRound();
        startCountdown();
        loop();
    }

    function restartSameDifficulty() {
        startGame(currentDifficulty);
    }

    function spawnPipe(xPos) {
        const h = Math.floor(Math.random() * (canvas.height - currentGap - 150)) + 75;
        pipes.push({ x: xPos, topHeight: h, passed: false });
    }

    function initRound() {
        bird = { x: 50, y: 300, velocity: 0, radius: 18, rotation: 0 };
        pipes = [];
        distanceTraveled = 0;
        
        spawnPipe(canvas.width); 
        
        isPaused = false;
        isCountingDown = false;
    }

    function drawBaldMan(x, y, rotation) {
        ctx.save();
        ctx.translate(x, y);
        ctx.rotate(rotation);
        ctx.fillStyle = '#ffdbac';
        ctx.beginPath(); ctx.arc(0, 0, 20, 0, Math.PI * 2); ctx.fill();
        ctx.strokeStyle = '#8d5524'; ctx.lineWidth = 2; ctx.stroke();
        ctx.strokeStyle = '#333'; ctx.lineWidth = 1.5;
        ctx.strokeRect(2, -8, 10, 8); ctx.strokeRect(14, -8, 10, 8);
        ctx.beginPath(); ctx.moveTo(12, -4); ctx.lineTo(14, -4); ctx.stroke();
        ctx.fillStyle = 'black';
        ctx.fillRect(6, -5, 2, 2); ctx.fillRect(18, -5, 2, 2);
        ctx.beginPath(); ctx.arc(10, 5, 5, 0.1 * Math.PI, 0.9 * Math.PI); ctx.stroke();
        ctx.restore();
    }

    function drawPaperTowel(x, y, height, isBottom) {
        ctx.fillStyle = '#fefefe'; 
        ctx.fillRect(x, y, 50, height);
        ctx.fillStyle = '#d7ba89';
        if (isBottom) ctx.fillRect(x + 10, y, 30, 8);
        else ctx.fillRect(x + 10, y + height - 8, 30, 8);
        ctx.strokeStyle = '#eee';
        for (let i = 20; i < height; i += 25) {
            ctx.beginPath(); ctx.moveTo(x, y + i); ctx.lineTo(x + 50, y + i); ctx.stroke();
        }
        ctx.strokeStyle = '#999'; ctx.strokeRect(x, y, 50, height);
    }

    function update() {
        if (!gameStarted || isPaused || isCountingDown) return;

        bird.velocity += GRAVITY;
        bird.y += bird.velocity;
        bird.rotation = Math.min(Math.PI / 4, Math.max(-Math.PI / 4, bird.velocity * 0.1));

        if (bird.y + bird.radius >= canvas.height || bird.y - bird.radius <= 0) {
            loseLife();
        }

        distanceTraveled += pipeSpeed;
        if (distanceTraveled >= HORIZONTAL_SPACING) {
            spawnPipe(canvas.width);
            distanceTraveled = 0;
        }

        pipes.forEach((p, i) => {
            p.x -= pipeSpeed;
            if (bird.x + bird.radius > p.x && bird.x - bird.radius < p.x + 50) {
                if (bird.y - bird.radius < p.topHeight || bird.y + bird.radius > p.topHeight + currentGap) {
                    loseLife();
                }
            }
            if (!p.passed && p.x + 50 < bird.x) {
                score++;
                p.passed = true;
            }
            if (p.x + 50 < 0) pipes.splice(i, 1);
        });
    }

    function draw() {
        ctx.fillStyle = '#70c5ce';
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        pipes.forEach(p => {
            drawPaperTowel(p.x, 0, p.topHeight, false);
            drawPaperTowel(p.x, p.topHeight + currentGap, canvas.height, true);
        });

        if (gameStarted || isPaused) drawBaldMan(bird.x, bird.y, bird.rotation);

        ctx.fillStyle = 'white';
        ctx.font = 'bold 30px Arial';
        ctx.textAlign = 'center';
        ctx.fillText(`Score: ${score}`, canvas.width / 2, 50);
        ctx.textAlign = 'left';
        ctx.font = '20px Arial';
        ctx.fillText("Lives: " + "❤️".repeat(Math.max(0, lives)), 10, canvas.height - 20);

        if (isCountingDown) {
            ctx.fillStyle = 'rgba(0,0,0,0.3)';
            ctx.fillRect(0,0, canvas.width, canvas.height);
            ctx.fillStyle = 'white';
            ctx.font = 'bold 80px Arial';
            ctx.textAlign = 'center';
            ctx.fillText(countdownValue, canvas.width / 2, canvas.height / 2);
        }
    }

    function startCountdown() {
        isCountingDown = true;
        countdownValue = 3;
        let timer = setInterval(() => {
            countdownValue--;
            if (countdownValue <= 0) {
                clearInterval(timer);
                isCountingDown = false;
            }
        }, 1000);
    }

    function loseLife() {
        lives--;
        isPaused = true;
        if (lives > 0) {
            ctx.fillStyle = 'rgba(255, 0, 0, 0.4)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            setTimeout(() => {
                initRound();
                startCountdown();
            }, 500);
        } else {
            gameStarted = false;
            finalScoreDisplay.innerText = "Final Score: " + score;
            uiContainer.style.display = 'block';
            startMenu.style.display = 'none';
            gameOverUI.style.display = 'block';
        }
    }

    function loop() {
        update();
        draw();
        if (lives > 0) requestAnimationFrame(loop);
    }

    function handleAction(e) {
        if (e.type === 'keydown' && e.code !== 'Space') return;
        if (gameStarted && !isPaused && !isCountingDown) {
            bird.velocity = JUMP;
        }
    }

    window.addEventListener('keydown', handleAction);
    canvas.addEventListener('mousedown', handleAction);
    draw();
</script>
</body>
</html>
